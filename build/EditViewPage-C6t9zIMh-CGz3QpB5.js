import{aZ as O,ab as q,u as z,q as G,c8 as Q,cg as U,c5 as Y,j as e,P as r,aA as k,$ as H,ea as S,eg as Z,e7 as c,eh as h,U as f,ei as _,eb as $,d as J,aP as K,w as W,c2 as X,c3 as ee,r as se,ej as te}from"./strapi-DJtumbce.js";import{a as ae,F as P}from"./Input-BR5JpzSp-B_2zxM1v.js";import"./Relations-B6iGFlMU-De-pLWdH.js";import"./relations-ksVp_JdY-1UvHanMM.js";import"./usePrev-Bjw2dhmq-C4LXt8zN.js";import"./useDragAndDrop-HYwNDExe-CYSRIY9Y.js";import"./objects-wl73iEma-8DZb34q3.js";import"./ComponentIcon-BZcTc4rj-BayANVzU.js";import"./getEmptyImage-CjqolaH3.js";const ie=s=>se.useEffect(s,ne),ne=[],oe=()=>{const s=O(),[{query:{status:a}},i]=q({status:"draft"}),{formatMessage:n}=z(),{toggleNotification:o}=G(),{document:x,meta:d,isLoading:T,schema:l,components:j,collectionType:v,id:C,model:D,hasError:I,getTitle:b,getInitialFormValues:A}=Q(),u=l?.options?.draftAndPublish??!1;ie(()=>{s?.state&&"error"in s.state&&o({type:"danger",message:s.state.error,timeout:5e3})});const R=U("EditViewPage",t=>t.isLoading),m=!C&&!(v===te),{isLoading:V,edit:{layout:y,settings:{mainField:L}}}=Y(D),{isLazyLoading:F}=ae([]),M=R||T||V||F,g=A(m);if(M&&!x?.documentId)return e.jsx(r.Loading,{});if(!g||I)return e.jsx(r.Error,{});const B=t=>{(t==="published"||t==="draft")&&i({status:t},"push",!0)},w=(t,p)=>S(l?.attributes,j,{status:a,...p}).validateSync(t,{abortEarly:!1});return e.jsxs(k,{paddingLeft:10,paddingRight:10,children:[e.jsx(r.Title,{children:b(L)}),e.jsx(H,{disabled:u&&a==="published",initialValues:g,method:m?"POST":"PUT",validate:(t,p)=>S(l?.attributes,j,{status:a,...p}).validate(t,{abortEarly:!1}),initialErrors:s?.state?.forceValidation?w(g,{}):{},children:({resetForm:t})=>e.jsxs(e.Fragment,{children:[e.jsx(Z,{isCreating:m,status:u?re(x,d):void 0,title:b(L)}),e.jsxs(c.Root,{variant:"simple",value:a,onValueChange:B,children:[e.jsx(c.List,{"aria-label":n({id:h("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:u?e.jsxs(e.Fragment,{children:[e.jsx(E,{value:"draft",children:n({id:h("containers.edit.tabs.draft"),defaultMessage:"draft"})}),e.jsx(E,{disabled:!d||d.availableStatus.length===0,value:"published",children:n({id:h("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),e.jsxs(f.Root,{paddingTop:8,gap:4,children:[e.jsxs(f.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[e.jsx(c.Content,{value:"draft",children:e.jsx(P,{layout:y})}),e.jsx(c.Content,{value:"published",children:e.jsx(P,{layout:y})})]}),e.jsx(f.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:e.jsx(_,{})})]})]}),e.jsx($,{onProceed:t})]})})]})},E=J(c.Trigger)`
  text-transform: uppercase;
`,re=(s,a)=>{const i=s?.status,n=a?.availableStatus??[];return i?i==="draft"&&n.find(o=>o.publishedAt!==null)?"published":i:"draft"},je=()=>{const{slug:s=""}=K(),{permissions:a=[],isLoading:i,error:n}=W(X.map(o=>({action:o,subject:s})));return i?e.jsx(r.Loading,{}):n||!s?e.jsx(r.Error,{}):e.jsx(r.Protect,{permissions:a,children:({permissions:o})=>e.jsx(ee,{permissions:o,children:e.jsx(oe,{})})})};export{oe as EditViewPage,je as ProtectedEditViewPage,re as getDocumentStatus};
