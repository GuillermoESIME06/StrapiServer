import{d as P,j as e,P as F,h0 as te,R as Ne,a as ge,F as b,c as je,bY as We,aZ as be,r as H,q as se,u as L,a5 as ye,t as ae,ab as Re,h1 as Ue,fL as Me,h2 as Fe,fS as He,o as Ce,w as oe,aA as ve,b as K,W as A,aF as Ge,e7 as G,B as V,at as _e,af as Y,g6 as qe,H as Qe,aJ as Ye,h3 as Ze,aP as Te,h4 as le,h5 as Je,h6 as Ke,ay as de,aK as Xe,aL as Ve,bt as et,bu as tt,fN as De,M as W,Q as st,S as at,X as w,Z as nt,bi as it,T as f,h7 as rt,h8 as ot,h9 as lt,ak as dt,al as ct,bq as we,br as Se,U as he,aE as ut,ez as ce,aN as X,ha as gt,hb as ht,aU as mt,g8 as pt,bP as ft,hc as xt,hd as jt,L as ze,ax as Ae,bB as bt,bC as yt,ad as _,C as Rt,G as q,he as Mt,hf as ie,c4 as Ct,et as O,hg as vt,hh as Tt,hi as ue,eY as Q,bD as U,dJ as Dt,a_ as wt}from"./strapi-DJtumbce.js";import{f as re}from"./index-BJsuMEQ5.js";import{t as St,a as zt,R as At,z as Lt}from"./schemas-DMt8h1z--BIG6YDxM.js";import{R as ee,a as It,c as Et}from"./index-Ba92iSq3.js";import{f as $t}from"./index-x8w3LH6m.js";import"./index-BRVyLNfZ.js";function Le(t,s,i){var a=St(t,i),r=zt(s,a,!0),n=new Date(a.getTime()-r),u=new Date(0);return u.setFullYear(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()),u.setHours(n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()),u}function Ie(t=ee){const s=t===ee?It:Et(t);return function(){const{store:a}=s();return a}}const Pt=Ie();function kt(t=ee){const s=t===ee?Pt:Ie(t);return function(){return s().dispatch}}const Bt=kt(),Ot=P(b)`
  width: 100%;
  max-width: 256px;

  & > * {
    border-bottom: 1px solid ${({theme:t})=>t.colors.neutral150};
  }

  & > *:last-child {
    border-bottom: none;
  }
`,Nt=({action:t,status:s,hasErrors:i,requiredStage:a,entryStage:r})=>{const{formatMessage:n}=L();return t==="publish"?i||a&&a.id!==r?.id?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(ue,{fill:"danger600"}),endIcon:e.jsx(Q,{}),children:e.jsx(f,{textColor:"danger600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.not-ready",defaultMessage:"Not ready to publish"})})})}):s==="draft"?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(Q,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-publish",defaultMessage:"Ready to publish"})})})}):s==="modified"?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(Dt,{fill:"alternative600"}),endIcon:e.jsx(Q,{}),children:e.jsx(f,{variant:"omega",fontWeight:"bold",textColor:"alternative600",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.modified",defaultMessage:"Ready to publish changes"})})})}):e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(Q,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.already-published",defaultMessage:"Already published"})})})}):s==="published"?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(Q,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-unpublish",defaultMessage:"Ready to unpublish"})})})}):e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(Q,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.already-unpublished",defaultMessage:"Already unpublished"})})})})},Wt=({hasErrors:t,errors:s,kind:i,contentTypeUid:a,documentId:r,locale:n})=>{const{formatMessage:u}=L();return e.jsxs(b,{direction:"column",gap:1,width:"100%",padding:5,children:[e.jsxs(b,{gap:2,width:"100%",children:[e.jsx(f,{fontWeight:"bold",children:u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields",defaultMessage:"Fields"})}),t?e.jsx(ue,{fill:"danger600"}):e.jsx(U,{fill:"success600"})]}),e.jsx(f,{width:"100%",textColor:"neutral600",children:t?u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.error",defaultMessage:"{errors} errors on fields."},{errors:s?Object.keys(s).length:0}):u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.success",defaultMessage:"All fields are filled correctly."})}),t&&e.jsx(ze,{tag:Ae,to:{pathname:`/content-manager/${i==="collectionType"?"collection-types":"single-types"}/${a}/${r}`,search:n?wt.stringify({plugins:{i18n:{locale:n}}}):""},variant:"secondary",fullWidth:!0,state:{forceValidation:!0},children:u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.see-errors",defaultMessage:"See errors"})})]})},Ut=({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:i})=>t?s&&s.id!==i?.id?e.jsx(ue,{fill:"danger600"}):e.jsx(U,{fill:"success600"}):e.jsx(U,{fill:"neutral200"}),Ft=({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:i,formatMessage:a})=>t?s&&s.id!==i?.id?a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-ready",defaultMessage:"This entry is not at the required stage for publishing. ({stageName})"},{stageName:s?.name??""}):s&&s.id===i?.id?a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.ready",defaultMessage:"This entry is at the required stage for publishing. ({stageName})"},{stageName:s?.name??""}):a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.stage-not-required",defaultMessage:"No required stage for publication"}):a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-enabled",defaultMessage:"This entry is not associated to any workflow."}),Ht=({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:i})=>{const{formatMessage:a}=L(),r=Ut({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:i});return e.jsxs(b,{direction:"column",gap:1,width:"100%",padding:5,children:[e.jsxs(b,{gap:2,width:"100%",children:[e.jsx(f,{fontWeight:"bold",children:a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage",defaultMessage:"Review stage"})}),r]}),e.jsx(f,{textColor:"neutral600",children:Ft({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:i,formatMessage:a})})]})},Gt=({schema:t,entry:s,status:i,action:a})=>{const{validate:r,isLoading:n}=Ct({collectionType:t?.kind??"",model:t?.uid??""},{skip:!0}),u=n?null:r(s),c=u?Object.keys(u).length>0:!1,p=t?.hasReviewWorkflow??!1,g=t?.stageRequiredToPublish,M=s.strapi_stage;return n?null:e.jsxs(O.Root,{children:[e.jsx(Nt,{action:a,status:i,hasErrors:c,requiredStage:g,entryStage:M}),e.jsx(O.Content,{children:e.jsxs(Ot,{direction:"column",children:[e.jsx(Wt,{hasErrors:c,errors:u,contentTypeUid:t?.uid,kind:t?.kind,documentId:s.documentId,locale:s.locale}),e.jsx(Ht,{contentTypeHasReviewWorkflow:p,requiredStage:g,entryStage:M})]})})]})},_t=["years","months","days","hours","minutes","seconds"],Ee=H.forwardRef(({timestamp:t,customIntervals:s=[],...i},a)=>{const{formatRelativeTime:r,formatDate:n,formatTime:u}=L(),c=et({start:t,end:Date.now()}),p=_t.find(l=>c[l]>0&&Object.keys(c).includes(l)),g=tt(t)?-c[p]:c[p],M=s.find(l=>c[l.unit]<l.threshold),v=M?M.text:r(g,p,{numeric:"auto"});return e.jsx("time",{ref:a,dateTime:t.toISOString(),role:"time",title:`${n(t)} ${u(t)}`,...i,children:v})}),$e=({handleClose:t,open:s,handleSubmit:i,initialValues:a,isLoading:r=!1})=>{const{formatMessage:n}=L(),{pathname:u}=be(),c=u===`/plugins/${vt}`,{timezoneList:p,systemTimezone:g={value:"UTC+00:00-Africa/Abidjan "}}=De(a.scheduledAt?new Date(a.scheduledAt):new Date),M=l=>{const{date:h,time:T,timezone:m}=l;if(!h||!T||!m)return null;const y=m.split("&")[1];return Lt(`${h} ${T}`,y)},v=()=>p.find(h=>h.value.split("&")[1]===a.timezone)?.value||g.value;return e.jsx(W.Root,{open:s,onOpenChange:t,children:e.jsxs(W.Content,{children:[e.jsx(W.Header,{children:e.jsx(W.Title,{children:n({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:c})})}),e.jsx(st,{onSubmit:l=>{i({...l,timezone:l.timezone?l.timezone.split("&")[1]:null,scheduledAt:l.isScheduled?M(l):null})},initialValues:{...a,timezone:a.timezone?v():g.value},validationSchema:At,validateOnChange:!1,children:({values:l,errors:h,handleChange:T,setFieldValue:m})=>e.jsxs(at,{children:[e.jsx(W.Body,{children:e.jsxs(b,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(w.Root,{name:"name",error:h.name&&n({id:h.name,defaultMessage:h.name}),required:!0,children:[e.jsx(w.Label,{children:n({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"})}),e.jsx(nt,{value:l.name,onChange:T}),e.jsx(w.Error,{})]}),e.jsx(V,{width:"max-content",children:e.jsx(it,{name:"isScheduled",checked:l.isScheduled,onCheckedChange:y=>{m("isScheduled",y),y?(m("date",a.date),m("time",a.time),m("timezone",a.timezone??g?.value)):(m("date",null),m("time",""),m("timezone",null))},children:e.jsx(f,{textColor:l.isScheduled?"primary600":"neutral800",fontWeight:l.isScheduled?"semiBold":"regular",children:n({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),l.isScheduled&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{gap:4,alignItems:"start",children:[e.jsx(V,{width:"100%",children:e.jsxs(w.Root,{name:"date",error:h.date&&n({id:h.date,defaultMessage:h.date}),required:!0,children:[e.jsx(w.Label,{children:n({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"})}),e.jsx(rt,{onChange:y=>{const D=y?$t(y,{representation:"date"}):null;m("date",D)},clearLabel:n({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{m("date",null)},value:l.date?new Date(l.date):new Date,minDate:Le(new Date,l.timezone.split("&")[1])}),e.jsx(w.Error,{})]})}),e.jsx(V,{width:"100%",children:e.jsxs(w.Root,{name:"time",error:h.time&&n({id:h.time,defaultMessage:h.time}),required:!0,children:[e.jsx(w.Label,{children:n({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"})}),e.jsx(ot,{onChange:y=>{m("time",y)},clearLabel:n({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{m("time","")},value:l.time||void 0}),e.jsx(w.Error,{})]})})]}),e.jsx(qt,{timezoneOptions:p})]})]})}),e.jsxs(W.Footer,{children:[e.jsx(W.Close,{children:e.jsx(A,{variant:"tertiary",name:"cancel",children:n({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(A,{name:"submit",loading:r,type:"submit",children:n({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:c})})]})]})})]})})},qt=({timezoneOptions:t})=>{const{values:s,errors:i,setFieldValue:a}=lt(),{formatMessage:r}=L(),[n,u]=H.useState(t);return H.useEffect(()=>{if(s.date){const{timezoneList:c}=De(new Date(s.date));u(c);const p=s.timezone&&c.find(g=>g.value.split("&")[1]===s.timezone.split("&")[1]);p&&a("timezone",p.value)}},[a,s.date,s.timezone]),e.jsxs(w.Root,{name:"timezone",error:i.timezone&&r({id:i.timezone,defaultMessage:i.timezone}),required:!0,children:[e.jsx(w.Label,{children:r({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"})}),e.jsx(dt,{autocomplete:{type:"list",filter:"contains"},value:s.timezone||void 0,textValue:s.timezone?s.timezone.replace(/&/," "):void 0,onChange:c=>{a("timezone",c)},onTextValueChange:c=>{a("timezone",c)},onClear:()=>{a("timezone","")},children:n.map(c=>e.jsx(ct,{value:c.value,children:c.value.replace(/&/," ")},c.value))}),e.jsx(w.Error,{})]})},Qt=Bt,Pe=t=>typeof t<"u"&&t.name!==void 0,Yt=P(je)`
  display: block;
`,Zt=P(Ee)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,ke=t=>{let s;switch(t){case"ready":s="success";break;case"blocked":s="warning";break;case"failed":s="danger";break;case"done":s="primary";break;case"empty":default:s="neutral"}return{textColor:`${s}600`,backgroundColor:`${s}100`,borderColor:`${s}200`}},me=({sectionTitle:t,releases:s=[],isError:i=!1})=>{const{formatMessage:a}=L();return i?e.jsx(F.Error,{}):s?.length===0?e.jsx(we,{content:a({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:t}),icon:e.jsx(Se,{width:"16rem"})}):e.jsx(he.Root,{gap:4,children:s.map(({id:r,name:n,scheduledAt:u,status:c})=>e.jsx(he.Item,{col:3,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Yt,{tag:ut,to:`${r}`,isExternal:!1,children:e.jsxs(b,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[e.jsxs(b,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(f,{textColor:"neutral800",tag:"h3",variant:"delta",fontWeight:"bold",children:n}),e.jsx(f,{variant:"pi",textColor:"neutral600",children:u?e.jsx(Zt,{timestamp:new Date(u)}):a({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),e.jsx(ce,{...ke(c),children:c})]})})},r))})},Jt=P(We)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,Kt={name:"",date:re(new Date,"yyyy-MM-dd"),time:"",isScheduled:!0,scheduledAt:null,timezone:null},Xt=()=>{const t=be(),[s,i]=H.useState(!1),{toggleNotification:a}=se(),{formatMessage:r}=L(),n=ye(),{formatAPIError:u}=ae(),[{query:c},p]=Re(),g=Ue(c),{data:M,isLoading:v}=Me(),[l,{isLoading:h}]=Fe(),{getFeature:T}=He(),{maximumReleases:m=3}=T("cms-content-releases"),{trackUsage:y}=Ce(),{allowedActions:{canCreate:D}}=oe(te),{isLoading:I,isSuccess:S,isError:d}=g,N=g?.currentData?.meta?.activeTab||"pending";H.useEffect(()=>{t?.state?.errors&&(a({type:"danger",title:r({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:r({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),n("",{replace:!0,state:null}))},[r,t?.state?.errors,n,a]);const C=()=>{i(z=>!z)};if(I||v)return e.jsx(F.Loading,{});const R=S&&g.currentData?.meta?.pendingReleasesCount||0,k=R>=m,B=z=>{p({...c,page:1,pageSize:g?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:z!=="pending"}}})},E=async({name:z,scheduledAt:o,timezone:x})=>{const j=await l({name:z,scheduledAt:o,timezone:x});"data"in j?(a({type:"success",message:r({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),y("didCreateRelease"),n(j.data.data.id.toString())):X(j.error)?a({type:"danger",message:u(j.error)}):a({type:"danger",message:r({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(ve,{"aria-busy":I||v,children:[e.jsx(K.Header,{title:r({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),subtitle:r({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:D?e.jsx(A,{startIcon:e.jsx(Ge,{}),onClick:C,disabled:k,children:r({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})}):null}),e.jsx(K.Content,{children:e.jsxs(e.Fragment,{children:[k&&e.jsx(Jt,{marginBottom:6,action:e.jsx(je,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:r({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:r({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:m}),onClose:()=>{},closeLabel:"",children:r({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),e.jsxs(G.Root,{variant:"simple",onValueChange:B,value:N,children:[e.jsxs(V,{paddingBottom:8,children:[e.jsxs(G.List,{"aria-label":r({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),children:[e.jsx(G.Trigger,{value:"pending",children:r({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:R})}),e.jsx(G.Trigger,{value:"done",children:r({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),e.jsx(_e,{})]}),e.jsx(G.Content,{value:"pending",children:e.jsx(me,{sectionTitle:"pending",releases:g?.currentData?.data,isError:d})}),e.jsx(G.Content,{value:"done",children:e.jsx(me,{sectionTitle:"done",releases:g?.currentData?.data,isError:d})})]}),e.jsxs(Y.Root,{...g?.currentData?.meta?.pagination,defaultPageSize:g?.currentData?.meta?.pagination?.pageSize,children:[e.jsx(Y.PageSize,{options:["8","16","32","64"]}),e.jsx(Y.Links,{})]})]})}),e.jsx($e,{open:s,handleClose:C,handleSubmit:E,isLoading:h,initialValues:{...Kt,timezone:M?.data.defaultTimezone?M.data.defaultTimezone.split("&")[1]:null}})]})},Vt=P(b)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:t})=>t.borderRadius};
  border-bottom-left-radius: ${({theme:t})=>t.borderRadius};
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,pe=P(qe)`
  svg path {
    fill: ${({theme:t,disabled:s})=>s&&t.colors.neutral500};
  }
  span {
    color: ${({theme:t,disabled:s})=>s&&t.colors.neutral500};
  }

  &:hover {
    background: ${({theme:t,$variant:s="neutral"})=>t.colors[`${s}100`]};
  }
`,es=P(Qe)`
  width: ${({theme:t})=>t.spaces[4]};
  height: ${({theme:t})=>t.spaces[4]};
  path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,ts=P(Ye)`
  width: ${({theme:t})=>t.spaces[4]};
  height: ${({theme:t})=>t.spaces[4]};
  path {
    fill: ${({theme:t})=>t.colors.danger600};
  }
`,fe=({toggleEditReleaseModal:t,toggleWarningSubmit:s,children:i})=>{const{formatMessage:a,formatDate:r,formatTime:n}=L(),{releaseId:u}=Te(),{data:c,isLoading:p,error:g}=le({id:u},{skip:!u}),[M,{isLoading:v}]=gt(),{toggleNotification:l}=se(),{formatAPIError:h}=ae(),{allowedActions:T}=oe(te),{canUpdate:m,canDelete:y,canPublish:D}=T,I=Qt(),{trackUsage:S}=Ce(),d=c?.data,N=x=>async()=>{const j=await M({id:x});if("data"in j){l({type:"success",message:a({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})});const{totalEntries:$,totalPublishedEntries:Z,totalUnpublishedEntries:J}=j.data.meta;S("didPublishRelease",{totalEntries:$,totalPublishedEntries:Z,totalUnpublishedEntries:J})}else X(j.error)?l({type:"danger",message:h(j.error)}):l({type:"danger",message:a({id:"notification.error",defaultMessage:"An error occurred"})})},C=()=>{I(Tt.util.invalidateTags([{type:"ReleaseAction",id:"LIST"},{type:"Release",id:u}]))},R=()=>d?.createdBy?d.createdBy.username?d.createdBy.username:d.createdBy.firstname?`${d.createdBy.firstname} ${d.createdBy.lastname||""}`.trim():d.createdBy.email:null;if(p)return e.jsx(F.Loading,{});if(Pe(g)&&"code"in g||!d)return e.jsx(de,{to:"..",state:{errors:[{code:g?.code}]}});const k=d.actions.meta.count||0,B=!!R(),E=d.scheduledAt&&d.timezone,z=a({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:k}),o=E?a({id:"content-releases.pages.ReleaseDetails.header-subtitle.scheduled",defaultMessage:"Scheduled for {date} at {time} ({offset})"},{date:r(new Date(d.scheduledAt),{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:d.timezone}),time:n(new Date(d.scheduledAt),{timeZone:d.timezone,hourCycle:"h23"}),offset:ht(d.timezone,new Date(d.scheduledAt))}):"";return e.jsxs(ve,{"aria-busy":p,children:[e.jsx(K.Header,{title:d.name,subtitle:e.jsxs(b,{gap:2,lineHeight:6,children:[e.jsx(f,{textColor:"neutral600",variant:"epsilon",children:z+(E?` - ${o}`:"")}),e.jsx(ce,{...ke(d.status),children:d.status})]}),navigationAction:e.jsx(mt,{fallback:".."}),primaryAction:!d.releasedAt&&e.jsxs(b,{gap:2,children:[e.jsxs(ss,{label:e.jsx(pt,{}),variant:"tertiary",endIcon:null,paddingLeft:"7px",paddingRight:"7px","aria-label":a({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release edit and delete menu"}),popoverPlacement:"bottom-end",children:[e.jsx(pe,{disabled:!m,onSelect:t,children:e.jsxs(b,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[e.jsx(es,{}),e.jsx(f,{ellipsis:!0,children:a({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})})]})}),e.jsx(pe,{disabled:!y,onSelect:s,$variant:"danger",children:e.jsxs(b,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[e.jsx(ts,{}),e.jsx(f,{ellipsis:!0,textColor:"danger600",children:a({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})})]})}),e.jsxs(Vt,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:4,children:[e.jsx(f,{variant:"pi",fontWeight:"bold",children:a({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),e.jsxs(f,{variant:"pi",color:"neutral300",children:[e.jsx(Ee,{timestamp:new Date(d.createdAt)}),a({id:"content-releases.header.actions.created.description",defaultMessage:"{hasCreatedByUser, select, true { by {createdBy}} other { by deleted user}}"},{createdBy:R(),hasCreatedByUser:B})]})]})]}),e.jsx(A,{size:"S",variant:"tertiary",onClick:C,children:a({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),D?e.jsx(A,{size:"S",variant:"default",onClick:N(d.id.toString()),loading:v,disabled:d.actions.meta.count===0,children:a({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})}):null]})}),i]})},ss=P(Ze)`
  & > span {
    display: flex;
  }
`,as=["contentType","locale","action"],ns=["contentType","action"],xe=t=>t==="locale"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.locales",defaultMessage:"Locales"}:t==="action"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.actions",defaultMessage:"Actions"}:{id:"content-releases.pages.ReleaseDetails.groupBy.option.content-type",defaultMessage:"Content-Types"},is=({releaseId:t})=>{const{formatMessage:s}=L(),[{query:i},a]=Re(),{toggleNotification:r}=se(),{formatAPIError:n}=ae(),{data:u,isLoading:c,error:p}=le({id:t}),{allowedActions:{canUpdate:g}}=oe(te),M=ft("ReleaseDetailsPage",o=>o.runHookWaterfall),{displayedHeaders:v,hasI18nEnabled:l}=M("ContentReleases/pages/ReleaseDetails/add-locale-in-releases",{displayedHeaders:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"},name:"name"}],hasI18nEnabled:!1}),h=u?.data,T=i?.groupBy||"contentType",{isLoading:m,isFetching:y,isError:D,data:I,error:S}=xt({...i,releaseId:t}),[d]=jt(),N=async(o,x,j)=>{const $=await d({params:{releaseId:t,actionId:x},body:{type:o.target.value},query:i,actionPath:j});"error"in $&&(X($.error)?r({type:"danger",message:n($.error)}):r({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})}))};if(m||c)return e.jsx(F.Loading,{});const C=I?.data,R=I?.meta,k=R?.contentTypes||{};if(R?.components,Pe(p)||!h){const o=[];return p&&"code"in p&&o.push({code:p.code}),S&&"code"in S&&o.push({code:S.code}),e.jsx(de,{to:"..",state:{errors:o}})}if(D||!C)return e.jsx(F.Error,{});if(Object.keys(C).length===0)return e.jsx(K.Content,{children:e.jsx(we,{action:e.jsx(ze,{tag:Ae,to:{pathname:"/content-manager"},style:{textDecoration:"none"},variant:"secondary",children:s({id:"content-releases.page.Details.button.openContentManager",defaultMessage:"Open the Content Manager"})}),icon:e.jsx(Se,{width:"16rem"}),content:s({id:"content-releases.pages.Details.tab.emptyEntries",defaultMessage:"This release is empty. Open the Content Manager, select an entry and add it to the release."})})});const B=s({id:"content-releases.pages.ReleaseDetails.groupBy.aria-label",defaultMessage:"Group by"}),E=[...v,{label:{id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"},name:"content-type"},{label:{id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"},name:"action"},...h.releasedAt?[]:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.status",defaultMessage:"status"},name:"status"}]],z=l?as:ns;return e.jsx(K.Content,{children:e.jsxs(b,{gap:8,direction:"column",alignItems:"stretch",children:[e.jsx(b,{children:e.jsx(bt,{placeholder:B,"aria-label":B,customizeContent:o=>s({id:"content-releases.pages.ReleaseDetails.groupBy.label",defaultMessage:"Group by {groupBy}"},{groupBy:o}),value:s(xe(T)),onChange:o=>a({groupBy:o}),children:z.map(o=>e.jsx(yt,{value:o,children:s(xe(o))},o))})}),Object.keys(C).map(o=>e.jsxs(b,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsx(b,{role:"separator","aria-label":o,children:e.jsx(ce,{children:o})}),e.jsx(_.Root,{rows:C[o].map(x=>({...x,id:Number(x.entry.id)})),headers:E,isLoading:m||y,children:e.jsxs(_.Content,{children:[e.jsx(_.Head,{children:E.map(({label:x,name:j})=>e.jsx(_.HeaderCell,{label:s(x),name:j},j))}),e.jsx(_.Loading,{}),e.jsx(_.Body,{children:C[o].map(({id:x,contentType:j,locale:$,type:Z,entry:J,status:Be},Oe)=>e.jsxs(Rt,{children:[e.jsx(q,{width:"25%",maxWidth:"200px",children:e.jsx(f,{ellipsis:!0,children:`${j.mainFieldValue||J.id}`})}),l&&e.jsx(q,{width:"10%",children:e.jsx(f,{children:`${$?.name?$.name:"-"}`})}),e.jsx(q,{width:"10%",children:e.jsx(f,{children:j.displayName||""})}),e.jsx(q,{width:"20%",children:h.releasedAt?e.jsx(f,{children:s({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:Z==="publish",b:ne=>e.jsx(f,{fontWeight:"bold",children:ne})})}):e.jsx(Mt,{selected:Z,handleChange:ne=>N(ne,x,[o,Oe]),name:`release-action-${x}-type`,disabled:!g})}),!h.releasedAt&&e.jsxs(e.Fragment,{children:[e.jsx(q,{width:"20%",minWidth:"200px",children:e.jsx(Gt,{action:Z,schema:k?.[j.uid],entry:J,status:Be})}),e.jsx(q,{children:e.jsx(b,{justifyContent:"flex-end",children:e.jsxs(ie.Root,{children:[e.jsx(ie.ReleaseActionEntryLinkItem,{contentTypeUid:j.uid,documentId:J.documentId,locale:$?.code}),e.jsx(ie.DeleteReleaseActionItem,{releaseId:h.id,actionId:x})]})})})]})]},x))})]})})]},`releases-group-${o}`)),e.jsxs(Y.Root,{...R?.pagination,defaultPageSize:R?.pagination?.pageSize,children:[e.jsx(Y.PageSize,{}),e.jsx(Y.Links,{})]})]})})},rs=()=>{const{formatMessage:t}=L(),{releaseId:s}=Te(),{toggleNotification:i}=se(),{formatAPIError:a}=ae(),r=ye(),[n,u]=H.useState(!1),[c,p]=H.useState(!1),{isLoading:g,data:M,isSuccess:v}=le({id:s},{skip:!s}),{data:l,isLoading:h}=Me(),[T,{isLoading:m}]=Je(),[y]=Ke(),D=()=>{u(o=>!o)},I=()=>d?.timezone?d.timezone:l?.data.defaultTimezone?l.data.defaultTimezone:null,S=()=>p(o=>!o);if(g||h)return e.jsx(fe,{toggleEditReleaseModal:D,toggleWarningSubmit:S,children:e.jsx(F.Loading,{})});if(!s)return e.jsx(de,{to:".."});const d=v&&M?.data||null,N=d?.name||"",C=I(),R=d?.scheduledAt&&C?Le(d.scheduledAt,C):null,k=R?re(R,"yyyy-MM-dd"):void 0,B=R?re(R,"HH:mm"):"",E=async o=>{const x=await T({id:s,name:o.name,scheduledAt:o.scheduledAt,timezone:o.timezone});"data"in x?(i({type:"success",message:t({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}),D()):X(x.error)?i({type:"danger",message:a(x.error)}):i({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})},z=async()=>{const o=await y({id:s});"data"in o?r(".."):X(o.error)?i({type:"danger",message:a(o.error)}):i({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(fe,{toggleEditReleaseModal:D,toggleWarningSubmit:S,children:[e.jsx(is,{releaseId:s}),e.jsx($e,{open:n,handleClose:D,handleSubmit:E,isLoading:g||m,initialValues:{name:N||"",scheduledAt:R,date:k,time:B,isScheduled:!!R,timezone:C}}),e.jsx(Xe.Root,{open:c,onOpenChange:S,children:e.jsx(Ve,{onConfirm:z,children:t({id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"})})})]})},hs=()=>e.jsx(F.Protect,{permissions:te.main,children:e.jsxs(Ne,{children:[e.jsx(ge,{index:!0,element:e.jsx(Xt,{})}),e.jsx(ge,{path:":releaseId",element:e.jsx(rs,{})})]})});export{hs as App};
