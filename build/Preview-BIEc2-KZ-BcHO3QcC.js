import{d as B,T as G,e7 as A,F as x,b$ as Q,e8 as _,j as e,c0 as Y,c1 as Z,aP as H,w as X,P as w,B as j,c3 as J,aZ as K,u as b,r as S,ab as I,c7 as ee,b_ as te,e9 as se,c4 as ne,c5 as ae,$ as re,ea as E,eb as oe,I as R,bP as ie,q as D,b4 as U,dj as W,ec as ce,ed as de,ee as M,U as T,ef as L,a_ as le,ax as ue,bo as pe,cf as me}from"./strapi-DJtumbce.js";import{F as he}from"./Input-BR5JpzSp-B_2zxM1v.js";import{getDocumentStatus as $}from"./EditViewPage-C6t9zIMh-CGz3QpB5.js";import"./Relations-B6iGFlMU-De-pLWdH.js";import"./relations-ksVp_JdY-1UvHanMM.js";import"./usePrev-Bjw2dhmq-C4LXt8zN.js";import"./useDragAndDrop-HYwNDExe-CYSRIY9Y.js";import"./objects-wl73iEma-8DZb34q3.js";import"./ComponentIcon-BZcTc4rj-BayANVzU.js";import"./getEmptyImage-CjqolaH3.js";const ge=()=>{const t=u("PreviewContent",a=>a.url),{formatMessage:n}=b();return e.jsx(j,{src:t,title:n({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},t)},O=()=>{const[{query:t}]=I(),{formatMessage:n}=b(),a=L("BackButton",c=>c.canGoBack),i=L("BackButton",c=>c.goBack),l=L("BackButton",c=>c.history),r=L("BackButton",c=>c.currentLocationIndex),m=a?l.at(r-2):void 0,p={pathname:"..",search:le.stringify(t,{encode:!1})},h=m??p,o=c=>{if(a){c.preventDefault(),i();return}};return e.jsx(R,{variant:"ghost",tag:ue,relative:"path",to:h,onClick:o,label:n({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(pe,{})})},V=()=>{const t=u("PreviewHeader",r=>r.document),n=u("PreviewHeader",r=>r.schema),a=u("PreviewHeader",r=>r.meta);if(!(n?.options?.draftAndPublish??!1))return null;const l=$(t,a);return e.jsx(me,{status:l,size:"XS"})},q=()=>{const{formatMessage:t}=b(),[{query:n},a]=I(),i=u("PreviewHeader",o=>o.document),l=u("PreviewHeader",o=>o.schema),r=u("PreviewHeader",o=>o.meta),m=l?.options?.draftAndPublish??!1,p=$(i,r),h=o=>{(o==="published"||o==="draft")&&a({status:o},"push",!0)};return m?e.jsx(A.Root,{variant:"simple",value:n.status||"draft",onValueChange:h,children:e.jsxs(A.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(F,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(F,{value:"published",disabled:p==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})}):null},fe=()=>{const t=u("PreviewHeader",d=>d.title),n=u("PreviewHeader",d=>d.document),a=u("PreviewHeader",d=>d.schema),i=u("PreviewHeader",d=>d.meta),l=ie("PreviewHeader",d=>d.plugins),r=u("PreviewHeader",d=>d.iframeRef),[{query:m}]=I(),{formatMessage:p}=b(),{toggleNotification:h}=D(),{copy:o}=U(),c=()=>{o(window.location.href),h({message:p({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})},s=a.options?.draftAndPublish??!1,f={activeTab:m.status??null,collectionType:a.kind==="collectionType"?"collection-types":"single-types",model:a.uid,documentId:n.documentId,document:n,meta:i,onPreview:()=>{r?.current?.contentWindow?.postMessage({type:"strapiUpdate"},new URL(r.current.src).origin)}};return e.jsxs(x,{height:"48px",gap:4,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(we,{height:"100%",paddingLeft:2,paddingRight:4,children:[e.jsx(O,{}),e.jsx(z,{tag:"h1",title:t,maxWidth:"200px",fontSize:2,paddingLeft:2,paddingRight:3,fontWeight:600,children:t}),e.jsx(V,{})]}),e.jsxs(x,{flex:1,paddingRight:2,gap:2,justifyContent:s?"space-between":"flex-end",children:[e.jsx(x,{flex:"1 1 70%",children:e.jsx(q,{})}),e.jsxs(x,{gap:2,children:[e.jsx(R,{type:"button",label:p({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:c,children:e.jsx(W,{})}),e.jsx(ce,{area:"preview.actions"}),e.jsx(de,{props:f,descriptions:l["content-manager"].apis.getDocumentActions("preview"),children:d=>{const k=d.filter(y=>[y.position].flat().includes("preview")),[g,v]=k;return!g&&!v?null:g&&v?e.jsxs(e.Fragment,{children:[e.jsx(M,{...v,variant:v.variant||"secondary"}),e.jsx(M,{...g,variant:g.variant||"default"})]}):e.jsx(M,{...g,variant:g.variant||"secondary"})}})]})]})]})},xe=()=>{const t=u("PreviewHeader",r=>r.title),{formatMessage:n}=b(),{toggleNotification:a}=D(),{copy:i}=U(),l=()=>{i(window.location.href),a({message:n({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(T.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(T.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(O,{}),e.jsx(z,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",title:t,children:t}),e.jsx(V,{})]}),e.jsx(T.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx(q,{})}),e.jsx(T.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(R,{type:"button",label:n({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:l,children:e.jsx(W,{})})})]})},z=B(G)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,F=B(A.Trigger)`
  text-transform: uppercase;
`,we=B(x)`
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
`,[ve,u]=Q("PreviewPage"),je=B(_)`
  will-change: transform;
  rotate: ${t=>t.isSideEditorOpen?"0deg":"180deg"};
  transition: rotate 0.2s ease-in-out;
`,be=()=>{const t=K(),{formatMessage:n}=b(),a=S.useRef(null),[i,l]=S.useState(!0),{slug:r,id:m,collectionType:p}=H(),[{query:h}]=I(),o=S.useMemo(()=>ee(h),[h]);if(!p)throw new Error("Could not find collectionType in url params");if(!r)throw new Error("Could not find model in url params");if(p===te&&!m)throw new Error("Could not find documentId in url params");const c=se({params:{contentType:r},query:{documentId:m,locale:o.locale,status:o.status}}),s=ne({model:r,collectionType:p,documentId:m,params:o}),f=ae(r);if((c.isLoading||f.isLoading||s.isLoading)&&!s.document?.documentId)return e.jsx(w.Loading,{});const k=s.getInitialFormValues();if(c.error||f.error||!s.document||!s.meta||!s.schema||!k)return e.jsx(w.Error,{});if(!c.data?.data?.url)return e.jsx(w.NoData,{});const g=s.getTitle(f.edit.settings.mainField),v=(P,C)=>E(s.schema?.attributes,s.components,{status:s.document?.status,...C}).validateSync(P,{abortEarly:!1}),y=c.data.data.url;return e.jsxs(e.Fragment,{children:[e.jsx(w.Title,{children:n({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:g})}),e.jsx(ve,{url:y,document:s.document,title:g,meta:s.meta,schema:s.schema,layout:f.edit,iframeRef:a,children:e.jsx(re,{method:"PUT",disabled:h.status==="published"&&s&&s.document.status!=="draft",initialValues:s.getInitialFormValues(),initialErrors:t?.state?.forceValidation?v(k,{}):{},height:"100%",validate:(P,C)=>E(s.schema?.attributes,s.components,{status:s.document?.status,...C}).validate(P,{abortEarly:!1}),children:({resetForm:P})=>e.jsx(x,{direction:"column",height:"100%",alignItems:"stretch",children:window.strapi.future.isEnabled("unstablePreviewSideEditor")?e.jsxs(e.Fragment,{children:[e.jsx(oe,{onProceed:P}),e.jsx(fe,{}),e.jsxs(x,{flex:1,overflow:"auto",alignItems:"stretch",children:[e.jsx(j,{overflow:"auto",width:i?"50%":0,borderWidth:"0 1px 0 0",borderColor:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:i?6:0,paddingRight:i?6:0,transition:"all 0.2s ease-in-out",children:e.jsx(he,{layout:f.edit.layout,hasBackground:!0})}),e.jsxs(j,{position:"relative",flex:1,height:"100%",overflow:"hidden",children:[e.jsx(j,{"data-testid":"preview-iframe",ref:a,src:y,title:n({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},y),e.jsx(R,{variant:"tertiary",label:n(i?{id:"content-manager.preview.content.close-editor",defaultMessage:"Close editor"}:{id:"content-manager.preview.content.open-editor",defaultMessage:"Open editor"}),onClick:()=>l(C=>!C),position:"absolute",top:2,left:2,children:e.jsx(je,{isSideEditorOpen:i})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{}),e.jsx(ge,{})]})})})})]})},ye=()=>{const{slug:t}=H(),{permissions:n=[],isLoading:a,error:i}=X([{action:"plugin::content-manager.explorer.read",subject:t},{action:"plugin::content-manager.explorer.update",subject:t},{action:"plugin::content-manager.explorer.publish",subject:t}]);return a?e.jsx(w.Loading,{}):i||!t?e.jsx(j,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(w.Error,{})}):e.jsx(j,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(w.Protect,{permissions:n.filter(l=>l.action.includes("explorer.read")),children:e.jsx(J,{permissions:n,children:e.jsx(be,{})})})})},Ae=()=>e.jsx(Y,{children:e.jsx(Z,{children:e.jsx(ye,{})})});export{Ae as ProtectedPreviewPage,u as usePreviewContext};
